<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="MicroData parser">
    <meta name="author" content="@diogomiguel - Based on Bootstrap">

    <title>MicroData Parser</title>

    <!-- Bootstrap core CSS -->
    <link href="https://v4-alpha.getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/page.css" rel="stylesheet">
  </head>

  <body>

    <div class="site-wrapper">

      <div class="site-wrapper-inner">

        <div class="cover-container">

          <div class="inner cover">
            <h1 class="cover-heading">MicroData Parser</h1>
            <p class="lead">Bookmarklet that can analyse a web page, find product microdata and display the results.</p>
            <p class="lead">
              Bookmarklet (drag to bookmarks bar):
              <a href="javascript:!function(){%22use%20strict%22;function%20e(e,t){if(!(e%20instanceof%20t))throw%20new%20TypeError(%22Cannot%20call%20a%20class%20as%20a%20function%22)}function%20t(e){var%20a=1%3Carguments.length%26%26void%200!==arguments[1]%3Farguments[1]:{},n=e.querySelectorAll(%22:scope%20%3E%20[itemprop]%22),r=e.getAttribute(%22itemprop%22);if(n.length){var%20o={};r%3Fa[r]%3Fo=a[r]:a[r]=o:o=a,n.forEach(function(e){t(e,o)})}else{var%20i={value:e.getAttribute(%22content%22)||e.innerText||e.getAttribute(%22alt%22),url:e.getAttribute(%22href%22),src:e.getAttribute(%22src%22)};a[r]=a[r]%3F[a[r]].concat([i]):i}return%20a}function%20a(e,t){Object.keys(t).forEach(function(r){var%20o=t[r],i=document.createElement(%22tr%22),c=document.createElement(%22td%22),l=document.createTextNode(r);c.appendChild(l),i.appendChild(c);var%20s=document.createElement(%22td%22);if({}.hasOwnProperty.call(o,%22value%22))s.appendChild(n(o));else{var%20d=document.createElement(%22table%22),h=document.createElement(%22tbody%22);a(h,o),d.appendChild(h),s.appendChild(d),s.className=%22nested%22}i.appendChild(s),e.append(i)})}function%20n(e){var%20t=e.url,a=e.src,n=e.value,r=void%200;return%20t%3F(r=document.createElement(%22a%22),r.href=t,r.append(document.createTextNode(n))):a%3F(r=document.createElement(%22img%22),r.src=a,r.alt=n):r=document.createTextNode(n),r}function%20r(e,t){var%20a=document.getElementsByTagName(%22body%22)[0],n=document.createElement(%22div%22);return%20n.id=e,n.className=t+%22__container%22,a.appendChild(n),n}function%20o(e){var%20t=document.createElement(%22link%22);t.type=%22text/css%22,t.rel=%22stylesheet%22,t.href=e,t.title=%22Bookmarklet%20CSS%22,document.getElementsByTagName(%22head%22)[0].appendChild(t)}var%20i=function(){function%20e(e,t){for(var%20a,n=0;n%3Ct.length;n++)a=t[n],a.enumerable=a.enumerable||!1,a.configurable=!0,%22value%22in%20a%26%26(a.writable=!0),Object.defineProperty(e,a.key,a)}return%20function(t,a,n){return%20a%26%26e(t.prototype,a),n%26%26e(t,n),t}}(),c=%22function%22==typeof%20Symbol%26%26%22symbol%22==typeof%20Symbol.iterator%3Ffunction(e){return%20typeof%20e}:function(e){return%20e%26%26%22function%22==typeof%20Symbol%26%26e.constructor===Symbol%26%26e!==Symbol.prototype%3F%22symbol%22:typeof%20e},l=%22https://dl.dropboxusercontent.com/s/p8uck0xoffp2l5y/widget.css%3Fdl=0%22,s=function(e){return%22object%22===(void%200===e%3F%22undefined%22:c(e))%26%26null!==e%26%260%3Ce.nodeType};new(function(){function%20n(){var%20t=0%3Carguments.length%26%26void%200!==arguments[0]%3Farguments[0]:{},a=t.schemaName,r=void%200===a%3F%22Product%22:a,o=t.containerId,i=void%200===o%3F%22jsSchemaParser%22:o,c=t.classNamespace,l=void%200===c%3F%22schema-parser%22:c,s=t.maxTables,d=void%200===s%3F1:s;e(this,n),this.schemaName=r,this.containerId=i,this.classNamespace=l,this.maxTables=d,this.parsedData=[],this.error=null,this.containerDomEl=null}return%20i(n,[{key:%22parsePage%22,value:function(){var%20e=this,a=0%3Carguments.length%26%26void%200!==arguments[0]%3Farguments[0]:document;try{if(!s(a))throw%20new%20Error(a,%22is%20not%20a%20valid%20node%22);var%20n=a.querySelectorAll(%22[itemtype$='%22+this.schemaName+%22']%22);if(!n||0===n.length)throw%20new%20Error(%22The%20schema%20type%20%22+this.schemaName+%22%20was%20not%20found%20in%20this%20page%22);if(this.parsedData=[],n.forEach(function(a){if(e.parsedData.length%3Ce.maxTables){var%20n=t(a);n%26%26e.parsedData.push(n)}}),!this.hasData)throw%20new%20Error(%22Invalid%20schema%20types.%20Cannot%20parse.%22);this.error=null}catch(e){this.error=e,console.error(%22Error%20at%20parsing%20the%20page%20schema%20html:%22,e)}}},{key:%22clearContainer%22,value:function(){for(;this.containerEl.firstChild;)this.containerEl.removeChild(this.containerEl.firstChild)}},{key:%22hasSetupRender%22,value:function(){return%20document.querySelectorAll(%22link[href='%22+l+%22']%22).length||o(l),this.hasData||this.parsePage(),this.isError%3F(this.renderError(),!1):(this.clearContainer(),!0)}},{key:%22renderError%22,value:function(e){this.clearContainer();var%20t=document.createElement(%22span%22);t.className=this.classNamespace+%22__error%22,t.textContent=%22An%20error%20occurred:%20%22+(e||this.error),this.containerEl.appendChild(t)}},{key:%22renderTable%22,value:function(){var%20e=this;if(this.hasSetupRender()){this.parsedData.forEach(function(t,n){var%20r=document.createElement(%22table%22);r.className=e.classNamespace+%22__table%22;var%20o=document.createElement(%22caption%22),i=document.createTextNode(%22Generated%20%22+e.schemaName+%22%20Schema%20Table%20%23%22+(n+1));o.appendChild(i);var%20c=document.createElement(%22thead%22),l=document.createElement(%22tr%22),s=document.createElement(%22th%22),d=document.createElement(%22th%22),h=document.createTextNode(%22itemprop%22),u=document.createTextNode(%22value%22);s.appendChild(h),d.appendChild(u),l.appendChild(s),l.appendChild(d),c.appendChild(l);var%20m=document.createElement(%22tbody%22);a(m,t),r.appendChild(o),r.appendChild(c),r.appendChild(m),e.containerEl.appendChild(r),r.setAttribute(%22border%22,%220%22)});var%20t=document.createElement(%22button%22);t.setAttribute(%22aria-label%22,%22Close%22),t.setAttribute(%22type%22,%22button%22),t.className=%22schema-parser__close%22,this.containerEl.appendChild(t),t.addEventListener(%22click%22,this.handleClose.bind(this))}}},{key:%22renderJSON%22,value:function(){if(this.hasSetupRender()){var%20e=document.createElement(%22textarea%22);e.className=this.classNamespace+%22__textarea%22,e.value=JSON.stringify(this.parsedData),this.containerEl.appendChild(e)}}},{key:%22handleClose%22,value:function(){this.clearContainer()}},{key:%22hasData%22,get:function(){return%20this.parsedData%26%260%3Cthis.parsedData.length}},{key:%22containerEl%22,get:function(){return%20s(this.containerDomEl)||(this.containerDomEl=r(this.containerId,this.classNamespace)),this.containerDomEl}},{key:%22isError%22,get:function(){return!!this.error}}]),n}())({schemaName:%22Product%22}).renderTable()}();">MicroData Booklet Parser</a>
            </p>

            <div class="card">
              <div class="card-block">
                <article class="microdata-example">
                  <h2>Microdata example <small>from: http://schema.org/Product</small></h2>
                  <div itemscope itemtype="http://schema.org/Product">
                    <span itemprop="name">Dell UltraSharp 30" LCD Monitor</span>
                    <div itemprop="aggregateRating"
                      itemscope itemtype="http://schema.org/AggregateRating">
                      <span itemprop="ratingValue">87</span>
                      out of <span itemprop="bestRating">100</span>
                      based on <span itemprop="ratingCount">24</span> user ratings
                    </div>
                    <div itemprop="offers" itemscope itemtype="http://schema.org/AggregateOffer">
                      <span itemprop="lowPrice">$1250</span>
                      to <span itemprop="highPrice">$1495</span>
                      from <span itemprop="offerCount">8</span> sellers
                      Sellers:
                      <div itemprop="offers" itemscope itemtype="http://schema.org/Offer">
                          <a itemprop="url" href="save-a-lot-monitors.com/dell-30.html">
                          Save A Lot Monitors - $1250</a>
                      </div>
                      <div itemprop="offers" itemscope itemtype="http://schema.org/Offer">
                          <a itemprop="url" href="jondoe-gadgets.com/dell-30.html">
                          Jon Doe's Gadgets - $1350</a>
                      </div>
                    </div>
                  </div>
                </article>
                <p>
                  <button id="jsExampleBtn" type="button" class="btn btn-lg btn-secondary">Run Example</button>
                </p>
              </div>
            </div>
          </div>

        </div>

      </div>

    </div>

    <!-- Placed at the end of the document so the pages load faster -->
    <script src="script.js"></script>
    <script>
    (function () {
      document.addEventListener("DOMContentLoaded", () => {
        // Construct object
        const productMicroParser = new MicroSchemaParser({ schemaName: 'Product' });

        // Run example handler
        document.getElementById('jsExampleBtn').addEventListener('click', () => {
          productMicroParser.renderTable();
        })
      });
    })();
    </script>
  </body>
</html>
